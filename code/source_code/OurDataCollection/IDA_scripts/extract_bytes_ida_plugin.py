import idaapi
import idautils
import idc
from os import path


out_put_dir = "C:\\Users\\nguye\\Desktop\\NT230\\malware\\IDB\\bytesIDB"

def tobytes(filename):

    with open(filename + ".bytes" , "w" ) as file:
        for addr in range(idc.MinEA(), idc.MaxEA()):
            if addr % 0x10 == 0:
                file.write("{:08x}".format(addr))
            if idc.isLoaded(addr):
                file.write(" {:02x}".format(idc.Byte(addr)))
            else:
                file.write(" ??")
            if (addr + 1) % 0x10 == 0:
                file.write("\n")

def main(file_name):
    output_file = os.path.join(out_put_dir, file_name)
    tobytes(output_file)



if __name__ == '__main__':
    if not idaapi.get_plugin_options("file_name"):
        print("[!] -file_name option is missing")
        idc.Exit(1)
    
    plugin_options = idaapi.get_plugin_options("file_name")
    file_name = plugin_options

 

    main(file_name)
    idc.Exit(0)
    
    

