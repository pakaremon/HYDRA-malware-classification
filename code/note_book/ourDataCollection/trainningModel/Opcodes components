{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":21505,"status":"ok","timestamp":1716333992654,"user":{"displayName":"Nguyễn Thành Công","userId":"00177559625414537077"},"user_tz":-420},"id":"FSRz6T6ftrJN","outputId":"8ea18934-f41f-4430-ded4-3644f81a36b8"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":17751,"status":"ok","timestamp":1716334010403,"user":{"displayName":"Nguyễn Thành Công","userId":"00177559625414537077"},"user_tz":-420},"id":"FqYYnr80jJY6","outputId":"b558b25a-b575-441a-f88c-8c24295a51e7"},"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: pyyaml in /usr/local/lib/python3.10/dist-packages (6.0.1)\n","Requirement already satisfied: h5py in /usr/local/lib/python3.10/dist-packages (3.9.0)\n","Requirement already satisfied: numpy>=1.17.3 in /usr/local/lib/python3.10/dist-packages (from h5py) (1.25.2)\n"]}],"source":["!pip install pyyaml h5py  # Required to save models in HDF5 format"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":14531,"status":"ok","timestamp":1716334024927,"user":{"displayName":"Nguyễn Thành Công","userId":"00177559625414537077"},"user_tz":-420},"id":"H4AhIJAtK6bL","outputId":"036151f9-a407-4dc4-c83c-319a8f94c10f"},"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting tensorflow_text==2.15.0\n","  Downloading tensorflow_text-2.15.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (5.2 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m5.2/5.2 MB\u001b[0m \u001b[31m27.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: tensorflow-hub>=0.13.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow_text==2.15.0) (0.16.1)\n","Requirement already satisfied: tensorflow<2.16,>=2.15.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow_text==2.15.0) (2.15.0)\n","Requirement already satisfied: absl-py>=1.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (1.4.0)\n","Requirement already satisfied: astunparse>=1.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (1.6.3)\n","Requirement already satisfied: flatbuffers>=23.5.26 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (24.3.25)\n","Requirement already satisfied: gast!=0.5.0,!=0.5.1,!=0.5.2,>=0.2.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (0.5.4)\n","Requirement already satisfied: google-pasta>=0.1.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (0.2.0)\n","Requirement already satisfied: h5py>=2.9.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (3.9.0)\n","Requirement already satisfied: libclang>=13.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (18.1.1)\n","Requirement already satisfied: ml-dtypes~=0.2.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (0.2.0)\n","Requirement already satisfied: numpy<2.0.0,>=1.23.5 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (1.25.2)\n","Requirement already satisfied: opt-einsum>=2.3.2 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (3.3.0)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (24.0)\n","Requirement already satisfied: protobuf!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.20.3 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (3.20.3)\n","Requirement already satisfied: setuptools in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (67.7.2)\n","Requirement already satisfied: six>=1.12.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (1.16.0)\n","Requirement already satisfied: termcolor>=1.1.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2.4.0)\n","Requirement already satisfied: typing-extensions>=3.6.6 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (4.11.0)\n","Requirement already satisfied: wrapt<1.15,>=1.11.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (1.14.1)\n","Requirement already satisfied: tensorflow-io-gcs-filesystem>=0.23.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (0.37.0)\n","Requirement already satisfied: grpcio<2.0,>=1.24.3 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (1.63.0)\n","Requirement already satisfied: tensorboard<2.16,>=2.15 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2.15.2)\n","Requirement already satisfied: tensorflow-estimator<2.16,>=2.15.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2.15.0)\n","Requirement already satisfied: keras<2.16,>=2.15.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2.15.0)\n","Requirement already satisfied: tf-keras>=2.14.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow-hub>=0.13.0->tensorflow_text==2.15.0) (2.15.1)\n","Requirement already satisfied: wheel<1.0,>=0.23.0 in /usr/local/lib/python3.10/dist-packages (from astunparse>=1.6.0->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (0.43.0)\n","Requirement already satisfied: google-auth<3,>=1.6.3 in /usr/local/lib/python3.10/dist-packages (from tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2.27.0)\n","Requirement already satisfied: google-auth-oauthlib<2,>=0.5 in /usr/local/lib/python3.10/dist-packages (from tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (1.2.0)\n","Requirement already satisfied: markdown>=2.6.8 in /usr/local/lib/python3.10/dist-packages (from tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (3.6)\n","Requirement already satisfied: requests<3,>=2.21.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2.31.0)\n","Requirement already satisfied: tensorboard-data-server<0.8.0,>=0.7.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (0.7.2)\n","Requirement already satisfied: werkzeug>=1.0.1 in /usr/local/lib/python3.10/dist-packages (from tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (3.0.3)\n","Requirement already satisfied: cachetools<6.0,>=2.0.0 in /usr/local/lib/python3.10/dist-packages (from google-auth<3,>=1.6.3->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (5.3.3)\n","Requirement already satisfied: pyasn1-modules>=0.2.1 in /usr/local/lib/python3.10/dist-packages (from google-auth<3,>=1.6.3->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (0.4.0)\n","Requirement already satisfied: rsa<5,>=3.1.4 in /usr/local/lib/python3.10/dist-packages (from google-auth<3,>=1.6.3->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (4.9)\n","Requirement already satisfied: requests-oauthlib>=0.7.0 in /usr/local/lib/python3.10/dist-packages (from google-auth-oauthlib<2,>=0.5->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (1.3.1)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests<3,>=2.21.0->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (3.3.2)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests<3,>=2.21.0->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (3.7)\n","Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests<3,>=2.21.0->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2.0.7)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests<3,>=2.21.0->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2024.2.2)\n","Requirement already satisfied: MarkupSafe>=2.1.1 in /usr/local/lib/python3.10/dist-packages (from werkzeug>=1.0.1->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (2.1.5)\n","Requirement already satisfied: pyasn1<0.7.0,>=0.4.6 in /usr/local/lib/python3.10/dist-packages (from pyasn1-modules>=0.2.1->google-auth<3,>=1.6.3->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (0.6.0)\n","Requirement already satisfied: oauthlib>=3.0.0 in /usr/local/lib/python3.10/dist-packages (from requests-oauthlib>=0.7.0->google-auth-oauthlib<2,>=0.5->tensorboard<2.16,>=2.15->tensorflow<2.16,>=2.15.0->tensorflow_text==2.15.0) (3.2.2)\n","Installing collected packages: tensorflow_text\n","Successfully installed tensorflow_text-2.15.0\n"]}],"source":["%pip install tensorflow_text==2.15.0"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Kwj9SqgiehyI"},"outputs":[],"source":["import os\n","\n","import tensorflow as tf\n","import csv\n","import pandas as pd\n","from sklearn.metrics import confusion_matrix\n","from keras.models import load_model\n","from tensorflow.keras.models import model_from_json\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1716334033232,"user":{"displayName":"Nguyễn Thành Công","userId":"00177559625414537077"},"user_tz":-420},"id":"MWxFnDQLLgxa","outputId":"1295a600-925b-4fff-99b6-ae4eb3848443"},"outputs":[{"output_type":"stream","name":"stdout","text":["2.15.0\n"]}],"source":["import tensorflow_text\n","print(tensorflow_text.__version__)"]},{"cell_type":"markdown","metadata":{"id":"nBc9NN71DkJI"},"source":[]},{"cell_type":"markdown","metadata":{"id":"pYEN05bVzhe5"},"source":["# trainning opcode"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"m6V1OkNnz1fV"},"outputs":[],"source":["def create_lookup_table(vocabulary_mapping, num_oov_buckets):\n","    keys = [k for k in vocabulary_mapping.keys()]\n","    values = [tf.constant(vocabulary_mapping[k], dtype=tf.int64) for k in keys]\n","\n","    table = tf.lookup.StaticVocabularyTable(\n","        tf.lookup.KeyValueTensorInitializer(\n","            keys=keys,\n","            values=values\n","        ),\n","        num_oov_buckets\n","    )\n","    return table"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"UALnHpsBz2PN"},"outputs":[],"source":["import tensorflow_text as text\n","\n","\n","def _parse_tfrecord_function(example, lookup_table):\n","    example_fmt = {\n","            'opcodes': tf.io.FixedLenFeature([], tf.string),\n","            'label': tf.io.FixedLenFeature([], tf.int64)\n","        }\n","    parsed = tf.io.parse_single_example(example, example_fmt)\n","    tokenizer = text.WhitespaceTokenizer()\n","    tokens = tokenizer.tokenize(parsed['opcodes'])\n","    IDs = lookup_table.lookup(tokens)\n","    return IDs, parsed['label']\n","\n","\n","def make_dataset(filepath, lookup_table, SHUFFLE_BUFFER_SIZE=1024, BATCH_SIZE=32, EPOCHS=5):\n","    dataset = tf.data.TFRecordDataset(filepath)\n","    dataset = dataset.shuffle(SHUFFLE_BUFFER_SIZE)\n","    dataset = dataset.repeat(EPOCHS)\n","    dataset = dataset.map(lambda x: _parse_tfrecord_function(x, lookup_table))\n","    dataset = dataset.batch(batch_size=BATCH_SIZE)\n","    return dataset"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bi6PBoAf0qpN"},"outputs":[],"source":["parameters = {\n","\"V\": 461,\n","\"E\": 4,\n","\"conv\":{\n","  \"num_filters\": 100,\n","  \"size\":[3,5,7]\n","},\n","\"output\":9,\n","\"buffer_size\": 8000,\n","\"batch_size\":32,\n","\"epochs\":50,\n","\"learning_rate\":0.001,\n","\"seq_length\":50000,\n","\"gpu\":\"0\"\n","}"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zZRHSS6-0BMW"},"outputs":[],"source":["class ShallowCNN(tf.keras.Model):\n","    def __init__(self, parameters):\n","        super(ShallowCNN, self).__init__()\n","        self.parameters = parameters\n","\n","    def build(self, input_shapes):\n","        self.emb = tf.keras.layers.Embedding(self.parameters['V'], self.parameters['E'], input_shape=(None, self.parameters['seq_length']))\n","\n","        self.conv_3 = tf.keras.layers.Conv2D(self.parameters['conv']['num_filters'],\n","                                             (self.parameters['conv']['size'][0], self.parameters['E']),\n","                                             activation=\"relu\",\n","                                             input_shape=(None,\n","                                                          self.parameters['seq_length'],\n","                                                          self.parameters['E']))\n","        self.global_max_pooling_3 = tf.keras.layers.GlobalMaxPooling2D()\n","\n","        self.conv_5 = tf.keras.layers.Conv2D(self.parameters['conv']['num_filters'],\n","                                             (self.parameters['conv']['size'][1], self.parameters['E']),\n","                                             activation=\"relu\",\n","                                             input_shape=(None,\n","                                                          self.parameters['seq_length'],\n","                                                          self.parameters['E']))\n","        self.global_max_pooling_5 = tf.keras.layers.GlobalMaxPooling2D()\n","\n","\n","        self.conv_7 = tf.keras.layers.Conv2D(self.parameters['conv']['num_filters'],\n","                                             (self.parameters['conv']['size'][2], self.parameters['E']),\n","                                             activation=\"relu\",\n","                                             input_shape=(None,\n","                                                          self.parameters['seq_length'],\n","                                                          self.parameters['E']))\n","        self.global_max_pooling_7 = tf.keras.layers.GlobalMaxPooling2D()\n","\n","        self.dense_dropout = tf.keras.layers.Dropout(0.5)\n","        self.dense = tf.keras.layers.Dense(self.parameters['output'],\n","                                           activation=\"softmax\")\n","\n","    def call(self, input_tensor, training=False):\n","        emb = self.emb(input_tensor)\n","        emb_expanded = tf.keras.backend.expand_dims(emb, axis=-1)\n","\n","\n","        conv_3 = self.conv_3(emb_expanded)\n","        pool_3 = self.global_max_pooling_3(conv_3)\n","\n","        conv_5 = self.conv_5(emb_expanded)\n","        pool_5 = self.global_max_pooling_5(conv_5)\n","\n","        conv_7 = self.conv_7(emb_expanded)\n","        pool_7 = self.global_max_pooling_7(conv_7)\n","\n","        features = tf.keras.layers.concatenate([pool_3, pool_5, pool_7])\n","        features_dropout = self.dense_dropout(features, training=training)\n","        output = self.dense(features_dropout)\n","\n","        return output"]},{"cell_type":"markdown","metadata":{"id":"k3ZowJ077ot0"},"source":["# train for 5000 samples"]},{"cell_type":"code","execution_count":13,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0hK5aEe6r3QQ","outputId":"41b3e5ca-0dbc-4d02-b901-faa3104bf00f","executionInfo":{"status":"ok","timestamp":1716351937327,"user_tz":-420,"elapsed":7833044,"user":{"displayName":"Nguyễn Thành Công","userId":"00177559625414537077"}}},"outputs":[{"output_type":"stream","name":"stderr","text":["WARNING:tensorflow:Detecting that an object or model or tf.train.Checkpoint is being deleted with unrestored values. See the following logs for the specific values in question. To silence these warnings, use `status.expect_partial()`. See https://www.tensorflow.org/api_docs/python/tf/train/Checkpoint#restorefor details about the status object returned by the restore function.\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).emb.embeddings\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_3.kernel\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_3.bias\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_5.kernel\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_5.bias\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_7.kernel\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_7.bias\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).dense.kernel\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).dense.bias\n"]},{"output_type":"stream","name":"stdout","text":["LOADING WEIGHTS!!!!\n","/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/result_training/models/ShallowCNN/model_ep_49.ckpt\n","Current epoch: 0\n","Iteration step: 0; Loss: 0.764, Accuracy: 71.875%\n","Iteration step: 1; Loss: 0.826, Accuracy: 71.875%\n","Iteration step: 2; Loss: 0.820, Accuracy: 69.792%\n","Iteration step: 3; Loss: 0.814, Accuracy: 70.312%\n","Iteration step: 4; Loss: 0.809, Accuracy: 70.000%\n","Iteration step: 5; Loss: 0.817, Accuracy: 69.792%\n","Iteration step: 6; Loss: 0.806, Accuracy: 71.875%\n","Iteration step: 7; Loss: 0.791, Accuracy: 71.739%\n","Epoch: 0; Validation loss 0.7865131497383118; acc: 0.7565217614173889\n","Current epoch: 1\n","Iteration step: 0; Loss: 0.749, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.787, Accuracy: 78.125%\n","Iteration step: 2; Loss: 0.791, Accuracy: 75.000%\n","Iteration step: 3; Loss: 0.729, Accuracy: 78.906%\n","Iteration step: 4; Loss: 0.778, Accuracy: 75.625%\n","Iteration step: 5; Loss: 0.800, Accuracy: 72.917%\n","Iteration step: 6; Loss: 0.796, Accuracy: 73.661%\n","Iteration step: 7; Loss: 0.734, Accuracy: 74.348%\n","Epoch: 1; Validation loss 0.7757827043533325; acc: 0.717391312122345\n","Current epoch: 2\n","Iteration step: 0; Loss: 0.810, Accuracy: 62.500%\n","Iteration step: 1; Loss: 0.684, Accuracy: 75.000%\n","Iteration step: 2; Loss: 0.713, Accuracy: 75.000%\n","Iteration step: 3; Loss: 0.753, Accuracy: 71.094%\n","Iteration step: 4; Loss: 0.758, Accuracy: 72.500%\n","Iteration step: 5; Loss: 0.771, Accuracy: 71.354%\n","Iteration step: 6; Loss: 0.795, Accuracy: 70.982%\n","Iteration step: 7; Loss: 0.754, Accuracy: 71.304%\n","Epoch: 2; Validation loss 0.7683252096176147; acc: 0.7217391133308411\n","Current epoch: 3\n","Iteration step: 0; Loss: 0.988, Accuracy: 59.375%\n","Iteration step: 1; Loss: 0.867, Accuracy: 67.188%\n","Iteration step: 2; Loss: 0.808, Accuracy: 71.875%\n","Iteration step: 3; Loss: 0.823, Accuracy: 71.875%\n","Iteration step: 4; Loss: 0.786, Accuracy: 73.125%\n","Iteration step: 5; Loss: 0.783, Accuracy: 72.396%\n","Iteration step: 6; Loss: 0.775, Accuracy: 73.214%\n","Iteration step: 7; Loss: 0.757, Accuracy: 73.478%\n","Epoch: 3; Validation loss 0.7635124921798706; acc: 0.7652173638343811\n","Current epoch: 4\n","Iteration step: 0; Loss: 0.645, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.720, Accuracy: 75.000%\n","Iteration step: 2; Loss: 0.731, Accuracy: 76.042%\n","Iteration step: 3; Loss: 0.718, Accuracy: 75.000%\n","Iteration step: 4; Loss: 0.763, Accuracy: 72.500%\n","Iteration step: 5; Loss: 0.770, Accuracy: 73.438%\n","Iteration step: 6; Loss: 0.766, Accuracy: 73.214%\n","Iteration step: 7; Loss: 0.785, Accuracy: 73.043%\n","Epoch: 4; Validation loss 0.7581005692481995; acc: 0.739130437374115\n","Current epoch: 5\n","Iteration step: 0; Loss: 0.806, Accuracy: 65.625%\n","Iteration step: 1; Loss: 0.693, Accuracy: 76.562%\n","Iteration step: 2; Loss: 0.735, Accuracy: 76.042%\n","Iteration step: 3; Loss: 0.719, Accuracy: 76.562%\n","Iteration step: 4; Loss: 0.772, Accuracy: 72.500%\n","Iteration step: 5; Loss: 0.783, Accuracy: 72.917%\n","Iteration step: 6; Loss: 0.770, Accuracy: 73.661%\n","Iteration step: 7; Loss: 0.763, Accuracy: 73.478%\n","Epoch: 5; Validation loss 0.7540069818496704; acc: 0.752173900604248\n","Current epoch: 6\n","Iteration step: 0; Loss: 0.872, Accuracy: 65.625%\n","Iteration step: 1; Loss: 0.782, Accuracy: 71.875%\n","Iteration step: 2; Loss: 0.770, Accuracy: 73.958%\n","Iteration step: 3; Loss: 0.784, Accuracy: 74.219%\n","Iteration step: 4; Loss: 0.782, Accuracy: 75.625%\n","Iteration step: 5; Loss: 0.767, Accuracy: 77.083%\n","Iteration step: 6; Loss: 0.762, Accuracy: 77.232%\n","Iteration step: 7; Loss: 0.736, Accuracy: 77.391%\n","Epoch: 6; Validation loss 0.7438112497329712; acc: 0.782608687877655\n","Current epoch: 7\n","Iteration step: 0; Loss: 0.757, Accuracy: 75.000%\n","Iteration step: 1; Loss: 0.818, Accuracy: 73.438%\n","Iteration step: 2; Loss: 0.786, Accuracy: 73.958%\n","Iteration step: 3; Loss: 0.751, Accuracy: 75.781%\n","Iteration step: 4; Loss: 0.750, Accuracy: 75.000%\n","Iteration step: 5; Loss: 0.748, Accuracy: 76.042%\n","Iteration step: 6; Loss: 0.755, Accuracy: 76.339%\n","Iteration step: 7; Loss: 0.698, Accuracy: 76.957%\n","Epoch: 7; Validation loss 0.737252414226532; acc: 0.7434782385826111\n","Current epoch: 8\n","Iteration step: 0; Loss: 0.562, Accuracy: 81.250%\n","Iteration step: 1; Loss: 0.577, Accuracy: 79.688%\n","Iteration step: 2; Loss: 0.655, Accuracy: 77.083%\n","Iteration step: 3; Loss: 0.678, Accuracy: 76.562%\n","Iteration step: 4; Loss: 0.745, Accuracy: 73.125%\n","Iteration step: 5; Loss: 0.738, Accuracy: 73.438%\n","Iteration step: 6; Loss: 0.737, Accuracy: 72.768%\n","Iteration step: 7; Loss: 0.765, Accuracy: 72.174%\n","Epoch: 8; Validation loss 0.7323784232139587; acc: 0.747826099395752\n","Current epoch: 9\n","Iteration step: 0; Loss: 0.544, Accuracy: 87.500%\n","Iteration step: 1; Loss: 0.609, Accuracy: 84.375%\n","Iteration step: 2; Loss: 0.642, Accuracy: 80.208%\n","Iteration step: 3; Loss: 0.667, Accuracy: 77.344%\n","Iteration step: 4; Loss: 0.710, Accuracy: 75.000%\n","Iteration step: 5; Loss: 0.725, Accuracy: 73.958%\n","Iteration step: 6; Loss: 0.736, Accuracy: 73.661%\n","Iteration step: 7; Loss: 0.722, Accuracy: 73.913%\n","Epoch: 9; Validation loss 0.7241358757019043; acc: 0.769565224647522\n","Current epoch: 10\n","Iteration step: 0; Loss: 0.873, Accuracy: 71.875%\n","Iteration step: 1; Loss: 0.835, Accuracy: 75.000%\n","Iteration step: 2; Loss: 0.794, Accuracy: 77.083%\n","Iteration step: 3; Loss: 0.799, Accuracy: 77.344%\n","Iteration step: 4; Loss: 0.774, Accuracy: 78.750%\n","Iteration step: 5; Loss: 0.737, Accuracy: 78.646%\n","Iteration step: 6; Loss: 0.725, Accuracy: 79.911%\n","Iteration step: 7; Loss: 0.760, Accuracy: 79.130%\n","Epoch: 10; Validation loss 0.7216607928276062; acc: 0.7869565486907959\n","Current epoch: 11\n","Iteration step: 0; Loss: 0.636, Accuracy: 87.500%\n","Iteration step: 1; Loss: 0.581, Accuracy: 87.500%\n","Iteration step: 2; Loss: 0.663, Accuracy: 81.250%\n","Iteration step: 3; Loss: 0.703, Accuracy: 79.688%\n","Iteration step: 4; Loss: 0.700, Accuracy: 78.125%\n","Iteration step: 5; Loss: 0.716, Accuracy: 77.083%\n","Iteration step: 6; Loss: 0.732, Accuracy: 77.679%\n","Iteration step: 7; Loss: 0.692, Accuracy: 78.261%\n","Epoch: 11; Validation loss 0.7155379056930542; acc: 0.752173900604248\n","Current epoch: 12\n","Iteration step: 0; Loss: 0.650, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.657, Accuracy: 78.125%\n","Iteration step: 2; Loss: 0.660, Accuracy: 75.000%\n","Iteration step: 3; Loss: 0.660, Accuracy: 75.000%\n","Iteration step: 4; Loss: 0.698, Accuracy: 73.750%\n","Iteration step: 5; Loss: 0.724, Accuracy: 70.833%\n","Iteration step: 6; Loss: 0.713, Accuracy: 72.768%\n","Iteration step: 7; Loss: 0.808, Accuracy: 72.174%\n","Epoch: 12; Validation loss 0.7095584869384766; acc: 0.747826099395752\n","Current epoch: 13\n","Iteration step: 0; Loss: 0.766, Accuracy: 71.875%\n","Iteration step: 1; Loss: 0.724, Accuracy: 71.875%\n","Iteration step: 2; Loss: 0.770, Accuracy: 67.708%\n","Iteration step: 3; Loss: 0.744, Accuracy: 72.656%\n","Iteration step: 4; Loss: 0.735, Accuracy: 74.375%\n","Iteration step: 5; Loss: 0.711, Accuracy: 76.042%\n","Iteration step: 6; Loss: 0.717, Accuracy: 76.786%\n","Iteration step: 7; Loss: 0.746, Accuracy: 76.522%\n","Epoch: 13; Validation loss 0.7202261686325073; acc: 0.804347813129425\n","Current epoch: 14\n","Iteration step: 0; Loss: 0.639, Accuracy: 81.250%\n","Iteration step: 1; Loss: 0.688, Accuracy: 84.375%\n","Iteration step: 2; Loss: 0.687, Accuracy: 85.417%\n","Iteration step: 3; Loss: 0.684, Accuracy: 83.594%\n","Iteration step: 4; Loss: 0.663, Accuracy: 83.125%\n","Iteration step: 5; Loss: 0.706, Accuracy: 80.729%\n","Iteration step: 6; Loss: 0.720, Accuracy: 78.571%\n","Iteration step: 7; Loss: 0.713, Accuracy: 78.696%\n","Epoch: 14; Validation loss 0.70011305809021; acc: 0.7565217614173889\n","Current epoch: 15\n","Iteration step: 0; Loss: 0.585, Accuracy: 75.000%\n","Iteration step: 1; Loss: 0.720, Accuracy: 71.875%\n","Iteration step: 2; Loss: 0.736, Accuracy: 71.875%\n","Iteration step: 3; Loss: 0.718, Accuracy: 74.219%\n","Iteration step: 4; Loss: 0.722, Accuracy: 74.375%\n","Iteration step: 5; Loss: 0.721, Accuracy: 73.958%\n","Iteration step: 6; Loss: 0.706, Accuracy: 75.446%\n","Iteration step: 7; Loss: 0.692, Accuracy: 75.652%\n","Epoch: 15; Validation loss 0.6930992007255554; acc: 0.7739130258560181\n","Current epoch: 16\n","Iteration step: 0; Loss: 0.570, Accuracy: 75.000%\n","Iteration step: 1; Loss: 0.713, Accuracy: 73.438%\n","Iteration step: 2; Loss: 0.695, Accuracy: 76.042%\n","Iteration step: 3; Loss: 0.746, Accuracy: 73.438%\n","Iteration step: 4; Loss: 0.730, Accuracy: 75.000%\n","Iteration step: 5; Loss: 0.717, Accuracy: 76.562%\n","Iteration step: 6; Loss: 0.703, Accuracy: 76.786%\n","Iteration step: 7; Loss: 0.659, Accuracy: 77.391%\n","Epoch: 16; Validation loss 0.6862944960594177; acc: 0.782608687877655\n","Current epoch: 17\n","Iteration step: 0; Loss: 0.654, Accuracy: 81.250%\n","Iteration step: 1; Loss: 0.731, Accuracy: 78.125%\n","Iteration step: 2; Loss: 0.731, Accuracy: 77.083%\n","Iteration step: 3; Loss: 0.698, Accuracy: 77.344%\n","Iteration step: 4; Loss: 0.676, Accuracy: 76.875%\n","Iteration step: 5; Loss: 0.667, Accuracy: 78.125%\n","Iteration step: 6; Loss: 0.686, Accuracy: 76.786%\n","Iteration step: 7; Loss: 0.699, Accuracy: 76.957%\n","Epoch: 17; Validation loss 0.6808326244354248; acc: 0.7956521511077881\n","Current epoch: 18\n","Iteration step: 0; Loss: 0.603, Accuracy: 84.375%\n","Iteration step: 1; Loss: 0.675, Accuracy: 76.562%\n","Iteration step: 2; Loss: 0.749, Accuracy: 75.000%\n","Iteration step: 3; Loss: 0.738, Accuracy: 76.562%\n","Iteration step: 4; Loss: 0.716, Accuracy: 78.750%\n","Iteration step: 5; Loss: 0.703, Accuracy: 79.167%\n","Iteration step: 6; Loss: 0.696, Accuracy: 80.357%\n","Iteration step: 7; Loss: 0.677, Accuracy: 80.435%\n","Epoch: 18; Validation loss 0.6801972389221191; acc: 0.813043475151062\n","Current epoch: 19\n","Iteration step: 0; Loss: 0.632, Accuracy: 84.375%\n","Iteration step: 1; Loss: 0.581, Accuracy: 87.500%\n","Iteration step: 2; Loss: 0.684, Accuracy: 82.292%\n","Iteration step: 3; Loss: 0.665, Accuracy: 80.469%\n","Iteration step: 4; Loss: 0.644, Accuracy: 82.500%\n","Iteration step: 5; Loss: 0.644, Accuracy: 80.729%\n","Iteration step: 6; Loss: 0.674, Accuracy: 79.018%\n","Iteration step: 7; Loss: 0.715, Accuracy: 78.261%\n","Epoch: 19; Validation loss 0.672965407371521; acc: 0.782608687877655\n","Current epoch: 20\n","Iteration step: 0; Loss: 0.655, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.682, Accuracy: 79.688%\n","Iteration step: 2; Loss: 0.676, Accuracy: 79.167%\n","Iteration step: 3; Loss: 0.656, Accuracy: 80.469%\n","Iteration step: 4; Loss: 0.679, Accuracy: 78.750%\n","Iteration step: 5; Loss: 0.676, Accuracy: 78.646%\n","Iteration step: 6; Loss: 0.669, Accuracy: 79.018%\n","Iteration step: 7; Loss: 0.686, Accuracy: 78.696%\n","Epoch: 20; Validation loss 0.6723108887672424; acc: 0.804347813129425\n","Current epoch: 21\n","Iteration step: 0; Loss: 0.711, Accuracy: 71.875%\n","Iteration step: 1; Loss: 0.650, Accuracy: 82.812%\n","Iteration step: 2; Loss: 0.716, Accuracy: 79.167%\n","Iteration step: 3; Loss: 0.712, Accuracy: 77.344%\n","Iteration step: 4; Loss: 0.683, Accuracy: 80.000%\n","Iteration step: 5; Loss: 0.686, Accuracy: 80.208%\n","Iteration step: 6; Loss: 0.687, Accuracy: 79.464%\n","Iteration step: 7; Loss: 0.666, Accuracy: 79.565%\n","Epoch: 21; Validation loss 0.6653563380241394; acc: 0.8086956739425659\n","Current epoch: 22\n","Iteration step: 0; Loss: 0.721, Accuracy: 84.375%\n","Iteration step: 1; Loss: 0.670, Accuracy: 85.938%\n","Iteration step: 2; Loss: 0.633, Accuracy: 86.458%\n","Iteration step: 3; Loss: 0.639, Accuracy: 85.156%\n","Iteration step: 4; Loss: 0.640, Accuracy: 83.750%\n","Iteration step: 5; Loss: 0.648, Accuracy: 82.292%\n","Iteration step: 6; Loss: 0.667, Accuracy: 80.357%\n","Iteration step: 7; Loss: 0.709, Accuracy: 79.565%\n","Epoch: 22; Validation loss 0.6614139080047607; acc: 0.7869565486907959\n","Current epoch: 23\n","Iteration step: 0; Loss: 0.614, Accuracy: 84.375%\n","Iteration step: 1; Loss: 0.636, Accuracy: 84.375%\n","Iteration step: 2; Loss: 0.575, Accuracy: 86.458%\n","Iteration step: 3; Loss: 0.632, Accuracy: 81.250%\n","Iteration step: 4; Loss: 0.623, Accuracy: 81.250%\n","Iteration step: 5; Loss: 0.636, Accuracy: 80.729%\n","Iteration step: 6; Loss: 0.654, Accuracy: 79.018%\n","Iteration step: 7; Loss: 0.688, Accuracy: 79.130%\n","Epoch: 23; Validation loss 0.6495550274848938; acc: 0.800000011920929\n","Current epoch: 24\n","Iteration step: 0; Loss: 0.504, Accuracy: 84.375%\n","Iteration step: 1; Loss: 0.600, Accuracy: 81.250%\n","Iteration step: 2; Loss: 0.568, Accuracy: 84.375%\n","Iteration step: 3; Loss: 0.629, Accuracy: 81.250%\n","Iteration step: 4; Loss: 0.630, Accuracy: 82.500%\n","Iteration step: 5; Loss: 0.648, Accuracy: 81.250%\n","Iteration step: 6; Loss: 0.656, Accuracy: 80.804%\n","Iteration step: 7; Loss: 0.654, Accuracy: 80.870%\n","Epoch: 24; Validation loss 0.6462411880493164; acc: 0.800000011920929\n","Current epoch: 25\n","Iteration step: 0; Loss: 0.659, Accuracy: 65.625%\n","Iteration step: 1; Loss: 0.669, Accuracy: 73.438%\n","Iteration step: 2; Loss: 0.626, Accuracy: 78.125%\n","Iteration step: 3; Loss: 0.603, Accuracy: 78.906%\n","Iteration step: 4; Loss: 0.654, Accuracy: 76.250%\n","Iteration step: 5; Loss: 0.636, Accuracy: 78.646%\n","Iteration step: 6; Loss: 0.653, Accuracy: 78.571%\n","Iteration step: 7; Loss: 0.622, Accuracy: 79.130%\n","Epoch: 25; Validation loss 0.6389371752738953; acc: 0.7956521511077881\n","Current epoch: 26\n","Iteration step: 0; Loss: 0.644, Accuracy: 75.000%\n","Iteration step: 1; Loss: 0.587, Accuracy: 81.250%\n","Iteration step: 2; Loss: 0.678, Accuracy: 77.083%\n","Iteration step: 3; Loss: 0.662, Accuracy: 78.906%\n","Iteration step: 4; Loss: 0.650, Accuracy: 80.000%\n","Iteration step: 5; Loss: 0.615, Accuracy: 81.250%\n","Iteration step: 6; Loss: 0.650, Accuracy: 78.571%\n","Iteration step: 7; Loss: 0.626, Accuracy: 78.696%\n","Epoch: 26; Validation loss 0.6345647573471069; acc: 0.800000011920929\n","Current epoch: 27\n","Iteration step: 0; Loss: 0.501, Accuracy: 87.500%\n","Iteration step: 1; Loss: 0.647, Accuracy: 76.562%\n","Iteration step: 2; Loss: 0.690, Accuracy: 73.958%\n","Iteration step: 3; Loss: 0.715, Accuracy: 75.000%\n","Iteration step: 4; Loss: 0.685, Accuracy: 78.750%\n","Iteration step: 5; Loss: 0.645, Accuracy: 80.729%\n","Iteration step: 6; Loss: 0.645, Accuracy: 80.357%\n","Iteration step: 7; Loss: 0.615, Accuracy: 80.435%\n","Epoch: 27; Validation loss 0.6300379633903503; acc: 0.821739137172699\n","Current epoch: 28\n","Iteration step: 0; Loss: 0.468, Accuracy: 81.250%\n","Iteration step: 1; Loss: 0.507, Accuracy: 85.938%\n","Iteration step: 2; Loss: 0.567, Accuracy: 83.333%\n","Iteration step: 3; Loss: 0.544, Accuracy: 85.156%\n","Iteration step: 4; Loss: 0.598, Accuracy: 81.875%\n","Iteration step: 5; Loss: 0.623, Accuracy: 80.208%\n","Iteration step: 6; Loss: 0.631, Accuracy: 80.804%\n","Iteration step: 7; Loss: 0.652, Accuracy: 80.870%\n","Epoch: 28; Validation loss 0.6232606768608093; acc: 0.804347813129425\n","Current epoch: 29\n","Iteration step: 0; Loss: 0.701, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.660, Accuracy: 81.250%\n","Iteration step: 2; Loss: 0.580, Accuracy: 86.458%\n","Iteration step: 3; Loss: 0.575, Accuracy: 87.500%\n","Iteration step: 4; Loss: 0.603, Accuracy: 84.375%\n","Iteration step: 5; Loss: 0.581, Accuracy: 84.896%\n","Iteration step: 6; Loss: 0.626, Accuracy: 81.250%\n","Iteration step: 7; Loss: 0.633, Accuracy: 81.304%\n","Epoch: 29; Validation loss 0.6257604360580444; acc: 0.8173912763595581\n","Current epoch: 30\n","Iteration step: 0; Loss: 0.419, Accuracy: 93.750%\n","Iteration step: 1; Loss: 0.519, Accuracy: 89.062%\n","Iteration step: 2; Loss: 0.573, Accuracy: 85.417%\n","Iteration step: 3; Loss: 0.583, Accuracy: 83.594%\n","Iteration step: 4; Loss: 0.564, Accuracy: 85.000%\n","Iteration step: 5; Loss: 0.598, Accuracy: 82.812%\n","Iteration step: 6; Loss: 0.624, Accuracy: 81.696%\n","Iteration step: 7; Loss: 0.639, Accuracy: 81.739%\n","Epoch: 30; Validation loss 0.614357054233551; acc: 0.813043475151062\n","Current epoch: 31\n","Iteration step: 0; Loss: 0.582, Accuracy: 81.250%\n","Iteration step: 1; Loss: 0.611, Accuracy: 79.688%\n","Iteration step: 2; Loss: 0.599, Accuracy: 82.292%\n","Iteration step: 3; Loss: 0.610, Accuracy: 82.031%\n","Iteration step: 4; Loss: 0.626, Accuracy: 80.625%\n","Iteration step: 5; Loss: 0.613, Accuracy: 82.292%\n","Iteration step: 6; Loss: 0.625, Accuracy: 81.696%\n","Iteration step: 7; Loss: 0.623, Accuracy: 81.304%\n","Epoch: 31; Validation loss 0.6196488738059998; acc: 0.800000011920929\n","Current epoch: 32\n","Iteration step: 0; Loss: 0.588, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.564, Accuracy: 84.375%\n","Iteration step: 2; Loss: 0.590, Accuracy: 80.208%\n","Iteration step: 3; Loss: 0.567, Accuracy: 82.812%\n","Iteration step: 4; Loss: 0.604, Accuracy: 81.250%\n","Iteration step: 5; Loss: 0.597, Accuracy: 81.250%\n","Iteration step: 6; Loss: 0.621, Accuracy: 80.357%\n","Iteration step: 7; Loss: 0.621, Accuracy: 80.435%\n","Epoch: 32; Validation loss 0.6034508347511292; acc: 0.813043475151062\n","Current epoch: 33\n","Iteration step: 0; Loss: 0.702, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.684, Accuracy: 76.562%\n","Iteration step: 2; Loss: 0.710, Accuracy: 75.000%\n","Iteration step: 3; Loss: 0.664, Accuracy: 78.125%\n","Iteration step: 4; Loss: 0.648, Accuracy: 77.500%\n","Iteration step: 5; Loss: 0.629, Accuracy: 78.646%\n","Iteration step: 6; Loss: 0.613, Accuracy: 79.911%\n","Iteration step: 7; Loss: 0.574, Accuracy: 80.435%\n","Epoch: 33; Validation loss 0.5984377264976501; acc: 0.8086956739425659\n","Current epoch: 34\n","Iteration step: 0; Loss: 0.635, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.597, Accuracy: 81.250%\n","Iteration step: 2; Loss: 0.602, Accuracy: 81.250%\n","Iteration step: 3; Loss: 0.590, Accuracy: 81.250%\n","Iteration step: 4; Loss: 0.609, Accuracy: 81.250%\n","Iteration step: 5; Loss: 0.595, Accuracy: 80.208%\n","Iteration step: 6; Loss: 0.604, Accuracy: 81.250%\n","Iteration step: 7; Loss: 0.580, Accuracy: 81.739%\n","Epoch: 34; Validation loss 0.591581404209137; acc: 0.8260869383811951\n","Current epoch: 35\n","Iteration step: 0; Loss: 0.493, Accuracy: 87.500%\n","Iteration step: 1; Loss: 0.491, Accuracy: 90.625%\n","Iteration step: 2; Loss: 0.544, Accuracy: 86.458%\n","Iteration step: 3; Loss: 0.555, Accuracy: 84.375%\n","Iteration step: 4; Loss: 0.575, Accuracy: 84.375%\n","Iteration step: 5; Loss: 0.593, Accuracy: 82.812%\n","Iteration step: 6; Loss: 0.595, Accuracy: 82.143%\n","Iteration step: 7; Loss: 0.595, Accuracy: 81.739%\n","Epoch: 35; Validation loss 0.5850203633308411; acc: 0.821739137172699\n","Current epoch: 36\n","Iteration step: 0; Loss: 0.584, Accuracy: 78.125%\n","Iteration step: 1; Loss: 0.648, Accuracy: 78.125%\n","Iteration step: 2; Loss: 0.582, Accuracy: 81.250%\n","Iteration step: 3; Loss: 0.573, Accuracy: 82.812%\n","Iteration step: 4; Loss: 0.584, Accuracy: 83.125%\n","Iteration step: 5; Loss: 0.578, Accuracy: 83.854%\n","Iteration step: 6; Loss: 0.591, Accuracy: 82.589%\n","Iteration step: 7; Loss: 0.582, Accuracy: 82.609%\n","Epoch: 36; Validation loss 0.5828071236610413; acc: 0.834782600402832\n","Current epoch: 37\n","Iteration step: 0; Loss: 0.517, Accuracy: 87.500%\n","Iteration step: 1; Loss: 0.473, Accuracy: 89.062%\n","Iteration step: 2; Loss: 0.487, Accuracy: 88.542%\n","Iteration step: 3; Loss: 0.545, Accuracy: 84.375%\n","Iteration step: 4; Loss: 0.572, Accuracy: 83.125%\n","Iteration step: 5; Loss: 0.589, Accuracy: 81.771%\n","Iteration step: 6; Loss: 0.590, Accuracy: 82.143%\n","Iteration step: 7; Loss: 0.570, Accuracy: 82.609%\n","Epoch: 37; Validation loss 0.5781970620155334; acc: 0.8260869383811951\n","Current epoch: 38\n","Iteration step: 0; Loss: 0.567, Accuracy: 84.375%\n","Iteration step: 1; Loss: 0.504, Accuracy: 85.938%\n","Iteration step: 2; Loss: 0.522, Accuracy: 85.417%\n","Iteration step: 3; Loss: 0.522, Accuracy: 86.719%\n","Iteration step: 4; Loss: 0.559, Accuracy: 85.625%\n","Iteration step: 5; Loss: 0.571, Accuracy: 83.854%\n","Iteration step: 6; Loss: 0.580, Accuracy: 83.036%\n","Iteration step: 7; Loss: 0.614, Accuracy: 83.043%\n","Epoch: 38; Validation loss 0.5747568011283875; acc: 0.8260869383811951\n","Current epoch: 39\n","Iteration step: 0; Loss: 0.670, Accuracy: 68.750%\n","Iteration step: 1; Loss: 0.578, Accuracy: 75.000%\n","Iteration step: 2; Loss: 0.576, Accuracy: 79.167%\n","Iteration step: 3; Loss: 0.543, Accuracy: 82.812%\n","Iteration step: 4; Loss: 0.546, Accuracy: 83.750%\n","Iteration step: 5; Loss: 0.578, Accuracy: 82.292%\n","Iteration step: 6; Loss: 0.575, Accuracy: 82.143%\n","Iteration step: 7; Loss: 0.603, Accuracy: 81.739%\n","Epoch: 39; Validation loss 0.5718472003936768; acc: 0.8173912763595581\n","Current epoch: 40\n","Iteration step: 0; Loss: 0.534, Accuracy: 84.375%\n","Iteration step: 1; Loss: 0.580, Accuracy: 82.812%\n","Iteration step: 2; Loss: 0.532, Accuracy: 83.333%\n","Iteration step: 3; Loss: 0.539, Accuracy: 84.375%\n","Iteration step: 4; Loss: 0.574, Accuracy: 82.500%\n","Iteration step: 5; Loss: 0.568, Accuracy: 83.333%\n","Iteration step: 6; Loss: 0.569, Accuracy: 82.589%\n","Iteration step: 7; Loss: 0.624, Accuracy: 81.739%\n","Epoch: 40; Validation loss 0.5745201706886292; acc: 0.8260869383811951\n","Current epoch: 41\n","Iteration step: 0; Loss: 0.404, Accuracy: 93.750%\n","Iteration step: 1; Loss: 0.499, Accuracy: 85.938%\n","Iteration step: 2; Loss: 0.542, Accuracy: 81.250%\n","Iteration step: 3; Loss: 0.555, Accuracy: 82.812%\n","Iteration step: 4; Loss: 0.581, Accuracy: 81.250%\n","Iteration step: 5; Loss: 0.572, Accuracy: 81.771%\n","Iteration step: 6; Loss: 0.567, Accuracy: 82.143%\n","Iteration step: 7; Loss: 0.568, Accuracy: 81.739%\n","Epoch: 41; Validation loss 0.5591098070144653; acc: 0.821739137172699\n","Current epoch: 42\n","Iteration step: 0; Loss: 0.410, Accuracy: 93.750%\n","Iteration step: 1; Loss: 0.428, Accuracy: 89.062%\n","Iteration step: 2; Loss: 0.494, Accuracy: 87.500%\n","Iteration step: 3; Loss: 0.506, Accuracy: 87.500%\n","Iteration step: 4; Loss: 0.538, Accuracy: 84.375%\n","Iteration step: 5; Loss: 0.561, Accuracy: 82.812%\n","Iteration step: 6; Loss: 0.560, Accuracy: 83.482%\n","Iteration step: 7; Loss: 0.572, Accuracy: 83.043%\n","Epoch: 42; Validation loss 0.5532996654510498; acc: 0.843478262424469\n","Current epoch: 43\n","Iteration step: 0; Loss: 0.711, Accuracy: 71.875%\n","Iteration step: 1; Loss: 0.704, Accuracy: 76.562%\n","Iteration step: 2; Loss: 0.635, Accuracy: 79.167%\n","Iteration step: 3; Loss: 0.603, Accuracy: 81.250%\n","Iteration step: 4; Loss: 0.581, Accuracy: 81.875%\n","Iteration step: 5; Loss: 0.559, Accuracy: 82.812%\n","Iteration step: 6; Loss: 0.556, Accuracy: 82.589%\n","Iteration step: 7; Loss: 0.556, Accuracy: 83.043%\n","Epoch: 43; Validation loss 0.5466150641441345; acc: 0.8304347991943359\n","Current epoch: 44\n","Iteration step: 0; Loss: 0.709, Accuracy: 75.000%\n","Iteration step: 1; Loss: 0.631, Accuracy: 78.125%\n","Iteration step: 2; Loss: 0.597, Accuracy: 79.167%\n","Iteration step: 3; Loss: 0.579, Accuracy: 80.469%\n","Iteration step: 4; Loss: 0.577, Accuracy: 81.250%\n","Iteration step: 5; Loss: 0.588, Accuracy: 80.729%\n","Iteration step: 6; Loss: 0.568, Accuracy: 82.143%\n","Iteration step: 7; Loss: 0.543, Accuracy: 82.609%\n","Epoch: 44; Validation loss 0.5442312359809875; acc: 0.8391304612159729\n","Current epoch: 45\n","Iteration step: 0; Loss: 0.568, Accuracy: 81.250%\n","Iteration step: 1; Loss: 0.643, Accuracy: 79.688%\n","Iteration step: 2; Loss: 0.569, Accuracy: 83.333%\n","Iteration step: 3; Loss: 0.572, Accuracy: 82.812%\n","Iteration step: 4; Loss: 0.552, Accuracy: 84.375%\n","Iteration step: 5; Loss: 0.544, Accuracy: 83.854%\n","Iteration step: 6; Loss: 0.559, Accuracy: 83.482%\n","Iteration step: 7; Loss: 0.511, Accuracy: 83.913%\n","Epoch: 45; Validation loss 0.5466156601905823; acc: 0.8260869383811951\n","Current epoch: 46\n","Iteration step: 0; Loss: 0.545, Accuracy: 84.375%\n","Iteration step: 1; Loss: 0.468, Accuracy: 87.500%\n","Iteration step: 2; Loss: 0.549, Accuracy: 83.333%\n","Iteration step: 3; Loss: 0.542, Accuracy: 82.812%\n","Iteration step: 4; Loss: 0.560, Accuracy: 81.250%\n","Iteration step: 5; Loss: 0.528, Accuracy: 83.333%\n","Iteration step: 6; Loss: 0.550, Accuracy: 82.589%\n","Iteration step: 7; Loss: 0.531, Accuracy: 82.609%\n","Epoch: 46; Validation loss 0.5310918688774109; acc: 0.8391304612159729\n","Current epoch: 47\n","Iteration step: 0; Loss: 0.413, Accuracy: 90.625%\n","Iteration step: 1; Loss: 0.520, Accuracy: 81.250%\n","Iteration step: 2; Loss: 0.516, Accuracy: 83.333%\n","Iteration step: 3; Loss: 0.468, Accuracy: 86.719%\n","Iteration step: 4; Loss: 0.457, Accuracy: 88.125%\n","Iteration step: 5; Loss: 0.474, Accuracy: 86.979%\n","Iteration step: 6; Loss: 0.547, Accuracy: 83.036%\n","Iteration step: 7; Loss: 0.504, Accuracy: 83.478%\n","Epoch: 47; Validation loss 0.5310952663421631; acc: 0.834782600402832\n","Current epoch: 48\n","Iteration step: 0; Loss: 0.541, Accuracy: 81.250%\n","Iteration step: 1; Loss: 0.569, Accuracy: 78.125%\n","Iteration step: 2; Loss: 0.591, Accuracy: 77.083%\n","Iteration step: 3; Loss: 0.572, Accuracy: 78.906%\n","Iteration step: 4; Loss: 0.584, Accuracy: 80.000%\n","Iteration step: 5; Loss: 0.561, Accuracy: 81.250%\n","Iteration step: 6; Loss: 0.543, Accuracy: 83.036%\n","Iteration step: 7; Loss: 0.516, Accuracy: 83.478%\n","Epoch: 48; Validation loss 0.5212401747703552; acc: 0.843478262424469\n","Current epoch: 49\n","Iteration step: 0; Loss: 0.406, Accuracy: 93.750%\n","Iteration step: 1; Loss: 0.477, Accuracy: 89.062%\n","Iteration step: 2; Loss: 0.498, Accuracy: 86.458%\n","Iteration step: 3; Loss: 0.546, Accuracy: 81.250%\n","Iteration step: 4; Loss: 0.542, Accuracy: 81.250%\n","Iteration step: 5; Loss: 0.537, Accuracy: 81.250%\n","Iteration step: 6; Loss: 0.521, Accuracy: 82.143%\n","Iteration step: 7; Loss: 0.550, Accuracy: 81.739%\n","Epoch: 49; Validation loss 0.5212803483009338; acc: 0.821739137172699\n"]}],"source":["tf_record_file = '/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/process_data/opcode/demo_opcode_tf_record_train'\n","model = ShallowCNN(parameters)\n","\n","if os.path.isdir(\"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/result_training/models/{}/\".format(\"ShallowCNN\")):\n","   print(\"LOADING WEIGHTS!!!!\")\n","   latest = tf.train.latest_checkpoint(\"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/result_training/models/{}/\".format(\"ShallowCNN\"))\n","   print(latest)\n","   model.load_weights(latest)\n","\n","loss_func = tf.keras.losses.SparseCategoricalCrossentropy()\n","accuracy = tf.keras.metrics.SparseCategoricalAccuracy()\n","optimizer = tf.keras.optimizers.Adam(learning_rate=parameters['learning_rate'])\n","def train_loop(features, labels, training=False):\n","    # Define the GradientTape context\n","    with tf.GradientTape() as tape:\n","        # Get the probabilities\n","        predictions = model(features)\n","        labels = tf.dtypes.cast(labels, tf.float32)\n","        # Calculate the loss\n","        loss = loss_func(labels, predictions)\n","\n","    # Get the gradients\n","    gradients = tape.gradient(loss, model.trainable_variables)\n","    # Update the weights\n","    optimizer.apply_gradients(zip(gradients, model.trainable_variables))\n","\n","    return loss, predictions\n","\n","\n","vocabulary={\"UNK\": 0, \"NONE\": 1, \"PAD\": 2, \"andps\": 3, \"psubusb\": 4, \"por\": 5, \"jnz\": 6, \"fxch4\": 7, \"pabsw\": 8, \"bsr\": 9, \"setl\": 10, \"paddw\": 11, \"fxsave\": 12, \"vmwrite\": 13, \"bound\": 14, \"jo\": 15, \"movhps\": 16, \"into\": 17, \"vmovd\": 18, \"pxor\": 19, \"vinsertf128\": 20, \"vmovdqa\": 21, \"paddsw\": 22, \"fist\": 23, \"orps\": 24, \"vmovapd\": 25, \"paddusw\": 26, \"roundps\": 27, \"fsub\": 28, \"bsf\": 29, \"fcmovu\": 30, \"vorpd\": 31, \"packuswb\": 32, \"unpckhpd\": 33, \"shufpd\": 34, \"pminuw\": 35, \"psubq\": 36, \"arpl\": 37, \"pandn\": 38, \"extractps\": 39, \"vpunpckhbw\": 40, \"vcvtss2sd\": 41, \"vpmullw\": 42, \"bswap\": 43, \"rcr\": 44, \"pmovzxbd\": 45, \"movsd\": 46, \"lddqu\": 47, \"movhpd\": 48, \"packusdw\": 49, \"jns\": 50, \"pshuflw\": 51, \"jnb\": 52, \"psllw\": 53, \"cvttps2dq\": 54, \"cmova\": 55, \"psrlq\": 56, \"setnbe\": 57, \"fcmovbe\": 58, \"leave\": 59, \"punpckldq\": 60, \"ffreep\": 61, \"phaddd\": 62, \"cmovb\": 63, \"insertps\": 64, \"scas\": 65, \"cmpps\": 66, \"sub\": 67, \"punpckhqdq\": 68, \"xchg\": 69, \"fcmovnbe\": 70, \"rol\": 71, \"pmulhrsw\": 72, \"fstsw\": 73, \"movnti\": 74, \"jnp\": 75, \"setz\": 76, \"int\": 77, \"minsd\": 78, \"paddusb\": 79, \"mulps\": 80, \"fcompp\": 81, \"vextractf128\": 82, \"lar\": 83, \"psrld\": 84, \"seto\": 85, \"vperm2f128\": 86, \"js\": 87, \"fadd\": 88, \"not\": 89, \"jmp\": 90, \"lss\": 91, \"paddq\": 92, \"fcmovnb\": 93, \"pfsubr\": 94, \"psrlw\": 95, \"punpckhdq\": 96, \"sqrtss\": 97, \"jg\": 98, \"pavgw\": 99, \"rcpss\": 100, \"cvtsd2si\": 101, \"pmaddwd\": 102, \"ucomisd\": 103, \"btr\": 104, \"cmovbe\": 105, \"vmovsd\": 106, \"jge\": 107, \"cmpneqps\": 108, \"vpaddw\": 109, \"sbb\": 110, \"cmovp\": 111, \"fcomi\": 112, \"idiv\": 113, \"pavgusb\": 114, \"jl\": 115, \"psubusw\": 116, \"fsubr\": 117, \"btc\": 118, \"pfadd\": 119, \"pshufb\": 120, \"addps\": 121, \"pand\": 122, \"imul\": 123, \"lidt\": 124, \"pshufhw\": 125, \"movaps\": 126, \"fild\": 127, \"lfs\": 128, \"addsd\": 129, \"lgs\": 130, \"addpd\": 131, \"vmptrst\": 132, \"vpcmpeqw\": 133, \"pshufd\": 134, \"fidivr\": 135, \"divss\": 136, \"prefetcht2\": 137, \"psrldq\": 138, \"shl\": 139, \"psraw\": 140, \"cvtdq2pd\": 141, \"pcmpgtw\": 142, \"vmovddup\": 143, \"subpd\": 144, \"movsx\": 145, \"vpcmpgtw\": 146, \"xor\": 147, \"fmul\": 148, \"cmp\": 149, \"movss\": 150, \"retnw\": 151, \"vpextrw\": 152, \"femms\": 153, \"rcl\": 154, \"wait\": 155, \"pslld\": 156, \"orpd\": 157, \"vunpckhps\": 158, \"pinsrd\": 159, \"xbegin\": 160, \"inc\": 161, \"ficom\": 162, \"sgdt\": 163, \"test\": 164, \"setbe\": 165, \"mpsadbw\": 166, \"prefetchnta\": 167, \"cmpleps\": 168, \"pcmpeqd\": 169, \"cmovl\": 170, \"ffree\": 171, \"fdivp\": 172, \"cmpltps\": 173, \"cvttsd2si\": 174, \"pmaxub\": 175, \"vsqrtpd\": 176, \"fistp\": 177, \"fnstenv\": 178, \"punpcklbw\": 179, \"vpmaddwd\": 180, \"fxch\": 181, \"cvtpd2ps\": 182, \"ucomiss\": 183, \"setno\": 184, \"sar\": 185, \"maxps\": 186, \"pmuludq\": 187, \"cvtps2pd\": 188, \"vpaddusw\": 189, \"fsubrp\": 190, \"movlps\": 191, \"fld1\": 192, \"jb\": 193, \"and\": 194, \"jbe\": 195, \"pcmpeqw\": 196, \"fnsave\": 197, \"cmovo\": 198, \"out\": 199, \"frstor\": 200, \"ldmxcsr\": 201, \"div\": 202, \"cvtpi2ps\": 203, \"mulpd\": 204, \"add\": 205, \"pextrw\": 206, \"movq\": 207, \"pextrb\": 208, \"punpcklwd\": 209, \"shufps\": 210, \"fdivr\": 211, \"cvtsd2ss\": 212, \"adc\": 213, \"movq2dq\": 214, \"cmpltpd\": 215, \"paddb\": 216, \"cmps\": 217, \"addss\": 218, \"vpunpckldq\": 219, \"pmovzxwd\": 220, \"vaddps\": 221, \"cmovno\": 222, \"pfmul\": 223, \"pmaxsw\": 224, \"subss\": 225, \"cvtsi2ss\": 226, \"subsd\": 227, \"cdq\": 228, \"stmxcsr\": 229, \"vmptrld\": 230, \"setnl\": 231, \"shrd\": 232, \"push\": 233, \"or\": 234, \"fucompp\": 235, \"cvtdq2ps\": 236, \"vpshufhw\": 237, \"fnstsw\": 238, \"pmulhw\": 239, \"vmulps\": 240, \"xlat\": 241, \"cvtsi2sd\": 242, \"cmovnp\": 243, \"subps\": 244, \"pslldq\": 245, \"ror\": 246, \"fcmovne\": 247, \"pfrcpit1\": 248, \"mulss\": 249, \"psadbw\": 250, \"movmskps\": 251, \"fcomp\": 252, \"fnstcw\": 253, \"jp\": 254, \"divsd\": 255, \"movhlps\": 256, \"fmulp\": 257, \"fdiv\": 258, \"pfrcpit2\": 259, \"jno\": 260, \"setnz\": 261, \"fld\": 262, \"in\": 263, \"paddd\": 264, \"cmpeqsd\": 265, \"str\": 266, \"lds\": 267, \"setnb\": 268, \"aam\": 269, \"packsswb\": 270, \"sets\": 271, \"pminsw\": 272, \"vdivsd\": 273, \"xorpd\": 274, \"faddp\": 275, \"lldt\": 276, \"andnpd\": 277, \"pmovmskb\": 278, \"fucomp\": 279, \"retn\": 280, \"mov\": 281, \"fsubp\": 282, \"sqrtsd\": 283, \"clflush\": 284, \"pshufw\": 285, \"vrcpss\": 286, \"enter\": 287, \"vsubps\": 288, \"psubsb\": 289, \"fstp\": 290, \"movntdq\": 291, \"punpckhwd\": 292, \"cvtps2pi\": 293, \"fiadd\": 294, \"pfcmpge\": 295, \"setnp\": 296, \"pfrcp\": 297, \"psubw\": 298, \"movdq2q\": 299, \"lock\": 300, \"cmpsw\": 301, \"phaddw\": 302, \"sldt\": 303, \"pfsub\": 304, \"comisd\": 305, \"punpcklqdq\": 306, \"vcvttpd2dq\": 307, \"loopne\": 308, \"pop\": 309, \"lods\": 310, \"xadd\": 311, \"pblendvb\": 312, \"pcmpgtd\": 313, \"xorps\": 314, \"fcmovb\": 315, \"cmovge\": 316, \"movups\": 317, \"comiss\": 318, \"vdivps\": 319, \"pfnacc\": 320, \"fidiv\": 321, \"fucomi\": 322, \"fldenv\": 323, \"vmovaps\": 324, \"movntps\": 325, \"prefetchw\": 326, \"pmaddubsw\": 327, \"psubd\": 328, \"cmovns\": 329, \"pmulhuw\": 330, \"cmovs\": 331, \"setb\": 332, \"movlhps\": 333, \"movdqu\": 334, \"movzx\": 335, \"movmskpd\": 336, \"setle\": 337, \"psubsw\": 338, \"vshufps\": 339, \"prefetcht0\": 340, \"cmpnlesd\": 341, \"loop\": 342, \"cmpltsd\": 343, \"pswapd\": 344, \"vandnpd\": 345, \"unpcklpd\": 346, \"cld\": 347, \"cmovle\": 348, \"fldcw\": 349, \"lea\": 350, \"cmpxchg\": 351, \"fldz\": 352, \"vminsd\": 353, \"fcom\": 354, \"jz\": 355, \"cmpnlepd\": 356, \"shr\": 357, \"pminub\": 358, \"paddsb\": 359, \"fimul\": 360, \"vpsrad\": 361, \"rsqrtps\": 362, \"fxch7\": 363, \"minps\": 364, \"psubb\": 365, \"nop\": 366, \"call\": 367, \"minss\": 368, \"cvtss2sd\": 369, \"cvttps2pi\": 370, \"psrad\": 371, \"movntq\": 372, \"divps\": 373, \"vmovdqu\": 374, \"shld\": 375, \"cmplesd\": 376, \"stos\": 377, \"cvtss2si\": 378, \"vblendps\": 379, \"bts\": 380, \"mul\": 381, \"fisub\": 382, \"fcmove\": 383, \"retf\": 384, \"andpd\": 385, \"pinsrw\": 386, \"cmovg\": 387, \"pmullw\": 388, \"retfw\": 389, \"rcpps\": 390, \"vmread\": 391, \"sqrtps\": 392, \"maxss\": 393, \"jcxz\": 394, \"lsl\": 395, \"vpsllw\": 396, \"fisttp\": 397, \"packssdw\": 398, \"unpckhps\": 399, \"aad\": 400, \"lgdt\": 401, \"bt\": 402, \"vpermilps\": 403, \"pfmax\": 404, \"pfcmpgt\": 405, \"fucom\": 406, \"unpcklps\": 407, \"fbstp\": 408, \"psllq\": 409, \"movapd\": 410, \"palignr\": 411, \"fst\": 412, \"align\": 413, \"pextrd\": 414, \"vxorps\": 415, \"cvtps2dq\": 416, \"dec\": 417, \"ja\": 418, \"sal\": 419, \"movlpd\": 420, \"fisubr\": 421, \"phminposuw\": 422, \"andnps\": 423, \"pi2fd\": 424, \"movdqa\": 425, \"cmpxchg8b\": 426, \"vunpcklps\": 427, \"setnle\": 428, \"pf2id\": 429, \"fbld\": 430, \"jecxz\": 431, \"ficomp\": 432, \"punpckhbw\": 433, \"movd\": 434, \"fdivrp\": 435, \"loope\": 436, \"setp\": 437, \"mulsd\": 438, \"rsqrtss\": 439, \"pavgb\": 440, \"vmovups\": 441, \"fcmovnu\": 442, \"cvttss2si\": 443, \"les\": 444, \"xabort\": 445, \"neg\": 446, \"cmpneqpd\": 447, \"vpshuflw\": 448, \"pcmpeqb\": 449, \"setns\": 450, \"jle\": 451, \"pcmpgtb\": 452, \"dw\": 453, \"db\": 454, \"dd\": 455, \"stop_line\": 456, \"loc_\": 457, \"sub_\": 458, \"endp\": 459}\n","\n","lookup_table = create_lookup_table(vocabulary_mapping=vocabulary, num_oov_buckets=1)\n","\n","\n","# Training loop\n","# 1/ Iterate each epoch. An epoch is one pass through the dataset\n","# 2/ Whithin an epoch, iterate over each example in the training Dataset.\n","# 3/ Calculate model's loss and gradients\n","# 4/ Use an optimizer to update the model's variables\n","# 5/ Keep track of stats and repeat\n","\n","train_loss_results = []\n","train_accuracy_results = []\n","\n","validation_loss_results = []\n","validation_accuracy_results = []\n","\n","#checkpoint_path = \"models/ShallowCNN/model_ep_{}.ckpt\"\n","#checkpoint_dir = os.path.dirname(checkpoint_path)\n","\n","num_epochs = parameters['epochs']\n","\n","initial_loss = 10.0\n","\n","for epoch in range(num_epochs):\n","      print(\"Current epoch: {}\".format(epoch))\n","\n","      checkpoint_path = \"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/result_training/models/{}/\".format(\"ShallowCNN\") + \"model_ep_{}.ckpt\".format(epoch)\n","      #checkpoint_dir = os.path.dirname(checkpoint_path)\n","\n","      d_train = make_dataset(tf_record_file,\n","                              lookup_table,\n","                              parameters['buffer_size'],\n","                              parameters['batch_size'],\n","                              1)\n","      d_val = make_dataset(tf_record_file,\n","                            lookup_table,\n","                            1024,\n","                            1,\n","                            1)\n","\n","\n","      # Training metrics\n","      epoch_loss_avg = tf.keras.metrics.Mean()\n","      epoch_accuracy = tf.keras.metrics.SparseCategoricalAccuracy()\n","      # Validation metrics\n","      val_epoch_loss_avg = tf.keras.metrics.Mean()\n","      val_epoch_accuracy = tf.keras.metrics.SparseCategoricalAccuracy()\n","      tr_step = 0\n","\n","      # Training loop\n","      for step, (x, y) in enumerate(d_train):\n","\n","\n","          loss, y_ = train_loop(features=x, labels=y, training=True)\n","\n","          # Track progress\n","          epoch_loss_avg(loss)\n","          epoch_accuracy(y, y_)\n","          print(\"Iteration step: {}; Loss: {:.3f}, Accuracy: {:.3%}\".format(tr_step,\n","                                                                            epoch_loss_avg.result(),\n","                                                                            epoch_accuracy.result()))\n","\n","\n","          tr_step += 1\n","\n","      # End epoch\n","      train_loss_results.append(epoch_loss_avg.result())\n","      train_accuracy_results.append(epoch_accuracy.result())\n","\n","\n","\n","      # Run a validation loop at the end of each epoch.\n","      for x_batch_val, y_batch_val in d_val:\n","          val_logits = model(x_batch_val)\n","          val_loss = loss_func(y_batch_val, val_logits)\n","\n","          # Update metrics\n","          val_epoch_loss_avg(val_loss)\n","          val_epoch_accuracy(y_batch_val, val_logits)\n","\n","      val_acc = val_epoch_accuracy.result()\n","      val_loss = val_epoch_loss_avg.result()\n","      print('Epoch: {}; Validation loss {}; acc: {}'.format(epoch, val_loss, val_acc))\n","\n","      validation_loss_results.append(val_loss)\n","      validation_accuracy_results.append(val_acc)\n","\n","      if float(val_loss) < initial_loss:\n","          initial_loss = float(val_loss)\n","          model.save_weights(checkpoint_path) # Save only the weights\n","\n"]},{"cell_type":"markdown","metadata":{"id":"bXXLr-p4YWzN"},"source":["# test opcodess\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"0ZS3lyVPM58W"},"outputs":[],"source":["model1 = model"]},{"cell_type":"code","execution_count":14,"metadata":{"id":"db_ftmgXMo86","executionInfo":{"status":"ok","timestamp":1716352088329,"user_tz":-420,"elapsed":325,"user":{"displayName":"Nguyễn Thành Công","userId":"00177559625414537077"}}},"outputs":[],"source":["vocabulary={\"UNK\": 0, \"NONE\": 1, \"PAD\": 2, \"andps\": 3, \"psubusb\": 4, \"por\": 5, \"jnz\": 6, \"fxch4\": 7, \"pabsw\": 8, \"bsr\": 9, \"setl\": 10, \"paddw\": 11, \"fxsave\": 12, \"vmwrite\": 13, \"bound\": 14, \"jo\": 15, \"movhps\": 16, \"into\": 17, \"vmovd\": 18, \"pxor\": 19, \"vinsertf128\": 20, \"vmovdqa\": 21, \"paddsw\": 22, \"fist\": 23, \"orps\": 24, \"vmovapd\": 25, \"paddusw\": 26, \"roundps\": 27, \"fsub\": 28, \"bsf\": 29, \"fcmovu\": 30, \"vorpd\": 31, \"packuswb\": 32, \"unpckhpd\": 33, \"shufpd\": 34, \"pminuw\": 35, \"psubq\": 36, \"arpl\": 37, \"pandn\": 38, \"extractps\": 39, \"vpunpckhbw\": 40, \"vcvtss2sd\": 41, \"vpmullw\": 42, \"bswap\": 43, \"rcr\": 44, \"pmovzxbd\": 45, \"movsd\": 46, \"lddqu\": 47, \"movhpd\": 48, \"packusdw\": 49, \"jns\": 50, \"pshuflw\": 51, \"jnb\": 52, \"psllw\": 53, \"cvttps2dq\": 54, \"cmova\": 55, \"psrlq\": 56, \"setnbe\": 57, \"fcmovbe\": 58, \"leave\": 59, \"punpckldq\": 60, \"ffreep\": 61, \"phaddd\": 62, \"cmovb\": 63, \"insertps\": 64, \"scas\": 65, \"cmpps\": 66, \"sub\": 67, \"punpckhqdq\": 68, \"xchg\": 69, \"fcmovnbe\": 70, \"rol\": 71, \"pmulhrsw\": 72, \"fstsw\": 73, \"movnti\": 74, \"jnp\": 75, \"setz\": 76, \"int\": 77, \"minsd\": 78, \"paddusb\": 79, \"mulps\": 80, \"fcompp\": 81, \"vextractf128\": 82, \"lar\": 83, \"psrld\": 84, \"seto\": 85, \"vperm2f128\": 86, \"js\": 87, \"fadd\": 88, \"not\": 89, \"jmp\": 90, \"lss\": 91, \"paddq\": 92, \"fcmovnb\": 93, \"pfsubr\": 94, \"psrlw\": 95, \"punpckhdq\": 96, \"sqrtss\": 97, \"jg\": 98, \"pavgw\": 99, \"rcpss\": 100, \"cvtsd2si\": 101, \"pmaddwd\": 102, \"ucomisd\": 103, \"btr\": 104, \"cmovbe\": 105, \"vmovsd\": 106, \"jge\": 107, \"cmpneqps\": 108, \"vpaddw\": 109, \"sbb\": 110, \"cmovp\": 111, \"fcomi\": 112, \"idiv\": 113, \"pavgusb\": 114, \"jl\": 115, \"psubusw\": 116, \"fsubr\": 117, \"btc\": 118, \"pfadd\": 119, \"pshufb\": 120, \"addps\": 121, \"pand\": 122, \"imul\": 123, \"lidt\": 124, \"pshufhw\": 125, \"movaps\": 126, \"fild\": 127, \"lfs\": 128, \"addsd\": 129, \"lgs\": 130, \"addpd\": 131, \"vmptrst\": 132, \"vpcmpeqw\": 133, \"pshufd\": 134, \"fidivr\": 135, \"divss\": 136, \"prefetcht2\": 137, \"psrldq\": 138, \"shl\": 139, \"psraw\": 140, \"cvtdq2pd\": 141, \"pcmpgtw\": 142, \"vmovddup\": 143, \"subpd\": 144, \"movsx\": 145, \"vpcmpgtw\": 146, \"xor\": 147, \"fmul\": 148, \"cmp\": 149, \"movss\": 150, \"retnw\": 151, \"vpextrw\": 152, \"femms\": 153, \"rcl\": 154, \"wait\": 155, \"pslld\": 156, \"orpd\": 157, \"vunpckhps\": 158, \"pinsrd\": 159, \"xbegin\": 160, \"inc\": 161, \"ficom\": 162, \"sgdt\": 163, \"test\": 164, \"setbe\": 165, \"mpsadbw\": 166, \"prefetchnta\": 167, \"cmpleps\": 168, \"pcmpeqd\": 169, \"cmovl\": 170, \"ffree\": 171, \"fdivp\": 172, \"cmpltps\": 173, \"cvttsd2si\": 174, \"pmaxub\": 175, \"vsqrtpd\": 176, \"fistp\": 177, \"fnstenv\": 178, \"punpcklbw\": 179, \"vpmaddwd\": 180, \"fxch\": 181, \"cvtpd2ps\": 182, \"ucomiss\": 183, \"setno\": 184, \"sar\": 185, \"maxps\": 186, \"pmuludq\": 187, \"cvtps2pd\": 188, \"vpaddusw\": 189, \"fsubrp\": 190, \"movlps\": 191, \"fld1\": 192, \"jb\": 193, \"and\": 194, \"jbe\": 195, \"pcmpeqw\": 196, \"fnsave\": 197, \"cmovo\": 198, \"out\": 199, \"frstor\": 200, \"ldmxcsr\": 201, \"div\": 202, \"cvtpi2ps\": 203, \"mulpd\": 204, \"add\": 205, \"pextrw\": 206, \"movq\": 207, \"pextrb\": 208, \"punpcklwd\": 209, \"shufps\": 210, \"fdivr\": 211, \"cvtsd2ss\": 212, \"adc\": 213, \"movq2dq\": 214, \"cmpltpd\": 215, \"paddb\": 216, \"cmps\": 217, \"addss\": 218, \"vpunpckldq\": 219, \"pmovzxwd\": 220, \"vaddps\": 221, \"cmovno\": 222, \"pfmul\": 223, \"pmaxsw\": 224, \"subss\": 225, \"cvtsi2ss\": 226, \"subsd\": 227, \"cdq\": 228, \"stmxcsr\": 229, \"vmptrld\": 230, \"setnl\": 231, \"shrd\": 232, \"push\": 233, \"or\": 234, \"fucompp\": 235, \"cvtdq2ps\": 236, \"vpshufhw\": 237, \"fnstsw\": 238, \"pmulhw\": 239, \"vmulps\": 240, \"xlat\": 241, \"cvtsi2sd\": 242, \"cmovnp\": 243, \"subps\": 244, \"pslldq\": 245, \"ror\": 246, \"fcmovne\": 247, \"pfrcpit1\": 248, \"mulss\": 249, \"psadbw\": 250, \"movmskps\": 251, \"fcomp\": 252, \"fnstcw\": 253, \"jp\": 254, \"divsd\": 255, \"movhlps\": 256, \"fmulp\": 257, \"fdiv\": 258, \"pfrcpit2\": 259, \"jno\": 260, \"setnz\": 261, \"fld\": 262, \"in\": 263, \"paddd\": 264, \"cmpeqsd\": 265, \"str\": 266, \"lds\": 267, \"setnb\": 268, \"aam\": 269, \"packsswb\": 270, \"sets\": 271, \"pminsw\": 272, \"vdivsd\": 273, \"xorpd\": 274, \"faddp\": 275, \"lldt\": 276, \"andnpd\": 277, \"pmovmskb\": 278, \"fucomp\": 279, \"retn\": 280, \"mov\": 281, \"fsubp\": 282, \"sqrtsd\": 283, \"clflush\": 284, \"pshufw\": 285, \"vrcpss\": 286, \"enter\": 287, \"vsubps\": 288, \"psubsb\": 289, \"fstp\": 290, \"movntdq\": 291, \"punpckhwd\": 292, \"cvtps2pi\": 293, \"fiadd\": 294, \"pfcmpge\": 295, \"setnp\": 296, \"pfrcp\": 297, \"psubw\": 298, \"movdq2q\": 299, \"lock\": 300, \"cmpsw\": 301, \"phaddw\": 302, \"sldt\": 303, \"pfsub\": 304, \"comisd\": 305, \"punpcklqdq\": 306, \"vcvttpd2dq\": 307, \"loopne\": 308, \"pop\": 309, \"lods\": 310, \"xadd\": 311, \"pblendvb\": 312, \"pcmpgtd\": 313, \"xorps\": 314, \"fcmovb\": 315, \"cmovge\": 316, \"movups\": 317, \"comiss\": 318, \"vdivps\": 319, \"pfnacc\": 320, \"fidiv\": 321, \"fucomi\": 322, \"fldenv\": 323, \"vmovaps\": 324, \"movntps\": 325, \"prefetchw\": 326, \"pmaddubsw\": 327, \"psubd\": 328, \"cmovns\": 329, \"pmulhuw\": 330, \"cmovs\": 331, \"setb\": 332, \"movlhps\": 333, \"movdqu\": 334, \"movzx\": 335, \"movmskpd\": 336, \"setle\": 337, \"psubsw\": 338, \"vshufps\": 339, \"prefetcht0\": 340, \"cmpnlesd\": 341, \"loop\": 342, \"cmpltsd\": 343, \"pswapd\": 344, \"vandnpd\": 345, \"unpcklpd\": 346, \"cld\": 347, \"cmovle\": 348, \"fldcw\": 349, \"lea\": 350, \"cmpxchg\": 351, \"fldz\": 352, \"vminsd\": 353, \"fcom\": 354, \"jz\": 355, \"cmpnlepd\": 356, \"shr\": 357, \"pminub\": 358, \"paddsb\": 359, \"fimul\": 360, \"vpsrad\": 361, \"rsqrtps\": 362, \"fxch7\": 363, \"minps\": 364, \"psubb\": 365, \"nop\": 366, \"call\": 367, \"minss\": 368, \"cvtss2sd\": 369, \"cvttps2pi\": 370, \"psrad\": 371, \"movntq\": 372, \"divps\": 373, \"vmovdqu\": 374, \"shld\": 375, \"cmplesd\": 376, \"stos\": 377, \"cvtss2si\": 378, \"vblendps\": 379, \"bts\": 380, \"mul\": 381, \"fisub\": 382, \"fcmove\": 383, \"retf\": 384, \"andpd\": 385, \"pinsrw\": 386, \"cmovg\": 387, \"pmullw\": 388, \"retfw\": 389, \"rcpps\": 390, \"vmread\": 391, \"sqrtps\": 392, \"maxss\": 393, \"jcxz\": 394, \"lsl\": 395, \"vpsllw\": 396, \"fisttp\": 397, \"packssdw\": 398, \"unpckhps\": 399, \"aad\": 400, \"lgdt\": 401, \"bt\": 402, \"vpermilps\": 403, \"pfmax\": 404, \"pfcmpgt\": 405, \"fucom\": 406, \"unpcklps\": 407, \"fbstp\": 408, \"psllq\": 409, \"movapd\": 410, \"palignr\": 411, \"fst\": 412, \"align\": 413, \"pextrd\": 414, \"vxorps\": 415, \"cvtps2dq\": 416, \"dec\": 417, \"ja\": 418, \"sal\": 419, \"movlpd\": 420, \"fisubr\": 421, \"phminposuw\": 422, \"andnps\": 423, \"pi2fd\": 424, \"movdqa\": 425, \"cmpxchg8b\": 426, \"vunpcklps\": 427, \"setnle\": 428, \"pf2id\": 429, \"fbld\": 430, \"jecxz\": 431, \"ficomp\": 432, \"punpckhbw\": 433, \"movd\": 434, \"fdivrp\": 435, \"loope\": 436, \"setp\": 437, \"mulsd\": 438, \"rsqrtss\": 439, \"pavgb\": 440, \"vmovups\": 441, \"fcmovnu\": 442, \"cvttss2si\": 443, \"les\": 444, \"xabort\": 445, \"neg\": 446, \"cmpneqpd\": 447, \"vpshuflw\": 448, \"pcmpeqb\": 449, \"setns\": 450, \"jle\": 451, \"pcmpgtb\": 452, \"dw\": 453, \"db\": 454, \"dd\": 455, \"stop_line\": 456, \"loc_\": 457, \"sub_\": 458, \"endp\": 459}\n","\n","lookup_table = create_lookup_table(vocabulary_mapping=vocabulary, num_oov_buckets=1)"]},{"cell_type":"code","execution_count":16,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":43123,"status":"ok","timestamp":1716352202047,"user":{"displayName":"Nguyễn Thành Công","userId":"00177559625414537077"},"user_tz":-420},"id":"hEgdMGAkkDp_","outputId":"d0cc9c80-9552-45ce-c4d5-0187885ccbcb"},"outputs":[{"output_type":"stream","name":"stdout","text":["LOADING WEIGHTS!!!!\n","Test loss 0.521240234375; acc: 0.843478262424469\n","Confusion Matrix:\n"," [[ 30   8   0   0   0   0]\n"," [  0 116   1   0   0   1]\n"," [  1  12  10   0   0   0]\n"," [  0   2   0   0   1   0]\n"," [  0   3   0   0  22   0]\n"," [  0   7   0   0   0  16]]\n"]}],"source":["model_test = ShallowCNN(parameters)\n","# model_test.load_weights(\"/content/drive/MyDrive/HK2_2023-2024/NT230/result_trainning/models/ShallowCNN/model_ep_12.ckpt\")\n","\n","if os.path.isdir(\"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/result_training/models/{}/\".format(\"ShallowCNN\")):\n","   print(\"LOADING WEIGHTS!!!!\")\n","   latest = tf.train.latest_checkpoint(\"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/result_training/models/{}/\".format(\"ShallowCNN\"))\n","   model_test.load_weights(latest)\n","\n","test_epoch_loss_avg = tf.keras.metrics.Mean()\n","test_epoch_accuracy = tf.keras.metrics.SparseCategoricalAccuracy()\n","\n","y_actual_test = []\n","y_pred_test = []\n","# Evaluate model on the test set\n","\n","d_test = make_dataset(\"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/process_data/opcode/demo_opcode_tf_record_train\",\n","                      lookup_table,\n","                      1,\n","                      1,\n","                      1)\n","\n","for x_batch_test, y_batch_test in d_test:\n","    test_logits = model_test(x_batch_test)\n","    test_loss = loss_func(y_batch_test, test_logits)\n","\n","    # For the confusion matrix\n","    y_pred = tf.argmax(test_logits, axis=-1)\n","    y_pred_test.extend(y_pred)\n","    y_actual_test.extend(y_batch_test)\n","\n","    # Update metrics\n","    test_epoch_loss_avg(test_loss)\n","    test_epoch_accuracy(y_batch_test, test_logits)\n","\n","test_acc = test_epoch_accuracy.result()\n","test_loss = test_epoch_loss_avg.result()\n","print('Test loss {}; acc: {}'.format(test_loss, test_acc))\n","\n","cm = confusion_matrix(y_actual_test, y_pred_test)\n","print(\"Confusion Matrix:\\n {}\".format(cm))"]},{"cell_type":"code","execution_count":18,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":11717,"status":"ok","timestamp":1716352334683,"user":{"displayName":"Nguyễn Thành Công","userId":"00177559625414537077"},"user_tz":-420},"id":"gNA-qaQaGAe_","outputId":"4be21834-11d5-4bc6-ad83-bbd7399cc367"},"outputs":[{"output_type":"stream","name":"stdout","text":["LOADING WEIGHTS!!!!\n","Test loss 0.9980037212371826; acc: 0.692307710647583\n","Confusion Matrix:\n"," [[ 5  1  0  0  0  0]\n"," [ 0 26  2  0  0  1]\n"," [ 1  0  0  0  0  1]\n"," [ 0  1  0  0  0  0]\n"," [ 0  4  0  0  2  0]\n"," [ 1  4  0  0  0  3]]\n"]}],"source":["model_test = ShallowCNN(parameters)\n","# model_test.load_weights(\"/content/drive/MyDrive/HK2_2023-2024/NT230/result_trainning/models/ShallowCNN/model_ep_12.ckpt\")\n","\n","if os.path.isdir(\"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/result_training/models/{}/\".format(\"ShallowCNN\")):\n","   print(\"LOADING WEIGHTS!!!!\")\n","   latest = tf.train.latest_checkpoint(\"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/result_training/models/{}/\".format(\"ShallowCNN\"))\n","   model_test.load_weights(latest)\n","\n","test_epoch_loss_avg = tf.keras.metrics.Mean()\n","test_epoch_accuracy = tf.keras.metrics.SparseCategoricalAccuracy()\n","\n","y_actual_test = []\n","y_pred_test = []\n","# Evaluate model on the test set\n","\n","d_test = make_dataset(\"/content/drive/MyDrive/HK2_2023-2024/NT230/demo_malware/process_data/opcode/demo_opcode_tf_record_test\",\n","                      lookup_table,\n","                      1,\n","                      1,\n","                      1)\n","\n","for x_batch_test, y_batch_test in d_test:\n","    test_logits = model_test(x_batch_test)\n","    test_loss = loss_func(y_batch_test, test_logits)\n","\n","    # For the confusion matrix\n","    y_pred = tf.argmax(test_logits, axis=-1)\n","    y_pred_test.extend(y_pred)\n","    y_actual_test.extend(y_batch_test)\n","\n","    # Update metrics\n","    test_epoch_loss_avg(test_loss)\n","    test_epoch_accuracy(y_batch_test, test_logits)\n","\n","test_acc = test_epoch_accuracy.result()\n","test_loss = test_epoch_loss_avg.result()\n","print('Test loss {}; acc: {}'.format(test_loss, test_acc))\n","\n","cm = confusion_matrix(y_actual_test, y_pred_test)\n","print(\"Confusion Matrix:\\n {}\".format(cm))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1429,"status":"ok","timestamp":1713410740678,"user":{"displayName":"Nguyễn Thành Công","userId":"07855209270426231427"},"user_tz":-420},"id":"gGy0cGM4IOWA","outputId":"0726cb87-6be2-4d33-c93b-12907272209f"},"outputs":[{"name":"stderr","output_type":"stream","text":["WARNING:tensorflow:Detecting that an object or model or tf.train.Checkpoint is being deleted with unrestored values. See the following logs for the specific values in question. To silence these warnings, use `status.expect_partial()`. See https://www.tensorflow.org/api_docs/python/tf/train/Checkpoint#restorefor details about the status object returned by the restore function.\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).emb.embeddings\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_3.kernel\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_3.bias\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_5.kernel\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_5.bias\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_7.kernel\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).conv_7.bias\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).dense.kernel\n","WARNING:tensorflow:Value in checkpoint could not be found in the restored object: (root).dense.bias\n"]},{"name":"stdout","output_type":"stream","text":["LOADING WEIGHTS!!!!\n"]}],"source":["test_tr = ShallowCNN(parameters)\n","# model_test.load_weights(\"/content/drive/MyDrive/HK2_2023-2024/NT230/result_trainning/models/ShallowCNN/model_ep_12.ckpt\")\n","\n","if os.path.isdir(\"/content/drive/MyDrive/HK2_2023-2024/NT230/result_trainning/models/{}/\".format(\"ShallowCNN\")):\n","   print(\"LOADING WEIGHTS!!!!\")\n","   latest = tf.train.latest_checkpoint(\"/content/drive/MyDrive/HK2_2023-2024/NT230/result_trainning/models/{}/\".format(\"ShallowCNN\"))\n","   test_tr.load_weights(latest)\n","\n","d_test = make_dataset(\"/content/drive/MyDrive/HK2_2023-2024/NT230/processData/Opcode/opcode_tf_record_test\",\n","                      lookup_table,\n","                      1,\n","                      1,\n","                      1)\n","for x_batch_test, y_batch_test in d_test:\n","    test_tr(x_batch_test)\n","    break\n","\n","\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":329,"status":"ok","timestamp":1713411084297,"user":{"displayName":"Nguyễn Thành Công","userId":"07855209270426231427"},"user_tz":-420},"id":"LJXichHxPNce","outputId":"6ebb325d-8266-478c-d2be-4049da3cc8b5"},"outputs":[{"name":"stdout","output_type":"stream","text":["[array([[ 0.25944492, -0.07129274,  0.13280305,  0.05998433],\n","       [ 0.02341154,  0.02827766, -0.0086977 ,  0.00122025],\n","       [-0.30409154,  0.29908797, -0.15273829,  0.47198862],\n","       ...,\n","       [-0.02153592, -0.04839319,  0.03893819,  0.0018658 ],\n","       [-0.03110635,  0.03800808,  0.0257141 , -0.02020764],\n","       [-0.0184991 , -0.03971901,  0.01098142,  0.00864998]],\n","      dtype=float32)]\n"]}],"source":["layer_names = [layer.name for layer in test_tr.layers]\n","print(test_tr.get_layer(layer_names[0]).get_weights())"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"FRq4i49xPJHk"},"outputs":[],"source":["d_train = make_dataset('/content/drive/MyDrive/HK2_2023-2024/NT230/processData/Opcode/opcode_tf_record_train',\n","                        lookup_table,\n","                        parameters['buffer_size'],\n","                        parameters['batch_size'],\n","                              1)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":406},"executionInfo":{"elapsed":645,"status":"error","timestamp":1713193045115,"user":{"displayName":"Nguyễn Thành Công","userId":"07855209270426231427"},"user_tz":-420},"id":"wpltPeZDPdGD","outputId":"05ccc107-2850-4a41-d633-a5f72fb1d3fa"},"outputs":[{"ename":"DataLossError","evalue":"{{function_node __wrapped__IteratorGetNext_output_types_2_device_/job:localhost/replica:0/task:0/device:CPU:0}} corrupted record at 3948893 [Op:IteratorGetNext] name: ","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mDataLossError\u001b[0m                             Traceback (most recent call last)","\u001b[0;32m<ipython-input-18-e52f5e9c7a10>\u001b[0m in \u001b[0;36m<cell line: 2>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0;32mimport\u001b[0m \u001b[0msys\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 2\u001b[0;31m \u001b[0;32mfor\u001b[0m \u001b[0mstep\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m(\u001b[0m\u001b[0mx\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0my\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32min\u001b[0m \u001b[0menumerate\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0md_train\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      3\u001b[0m     \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mx\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mshape\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      4\u001b[0m     \u001b[0mprint\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0my\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mshape\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      5\u001b[0m     \u001b[0;32mbreak\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.10/dist-packages/tensorflow/python/data/ops/iterator_ops.py\u001b[0m in \u001b[0;36m__next__\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    808\u001b[0m   \u001b[0;32mdef\u001b[0m \u001b[0m__next__\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    809\u001b[0m     \u001b[0;32mtry\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 810\u001b[0;31m       \u001b[0;32mreturn\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_next_internal\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    811\u001b[0m     \u001b[0;32mexcept\u001b[0m \u001b[0merrors\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mOutOfRangeError\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    812\u001b[0m       \u001b[0;32mraise\u001b[0m \u001b[0mStopIteration\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.10/dist-packages/tensorflow/python/data/ops/iterator_ops.py\u001b[0m in \u001b[0;36m_next_internal\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    771\u001b[0m     \u001b[0;31m# to communicate that there is no more data to iterate over.\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    772\u001b[0m     \u001b[0;32mwith\u001b[0m \u001b[0mcontext\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mexecution_mode\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mcontext\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mSYNC\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 773\u001b[0;31m       ret = gen_dataset_ops.iterator_get_next(\n\u001b[0m\u001b[1;32m    774\u001b[0m           \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_iterator_resource\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    775\u001b[0m           \u001b[0moutput_types\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_flat_output_types\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.10/dist-packages/tensorflow/python/ops/gen_dataset_ops.py\u001b[0m in \u001b[0;36miterator_get_next\u001b[0;34m(iterator, output_types, output_shapes, name)\u001b[0m\n\u001b[1;32m   3027\u001b[0m       \u001b[0;32mreturn\u001b[0m \u001b[0m_result\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   3028\u001b[0m     \u001b[0;32mexcept\u001b[0m \u001b[0m_core\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_NotOkStatusException\u001b[0m \u001b[0;32mas\u001b[0m \u001b[0me\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 3029\u001b[0;31m       \u001b[0m_ops\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mraise_from_not_ok_status\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0me\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mname\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   3030\u001b[0m     \u001b[0;32mexcept\u001b[0m \u001b[0m_core\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_FallbackException\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   3031\u001b[0m       \u001b[0;32mpass\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.10/dist-packages/tensorflow/python/framework/ops.py\u001b[0m in \u001b[0;36mraise_from_not_ok_status\u001b[0;34m(e, name)\u001b[0m\n\u001b[1;32m   5881\u001b[0m \u001b[0;32mdef\u001b[0m \u001b[0mraise_from_not_ok_status\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0me\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mname\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;34m->\u001b[0m \u001b[0mNoReturn\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   5882\u001b[0m   \u001b[0me\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mmessage\u001b[0m \u001b[0;34m+=\u001b[0m \u001b[0;34m(\u001b[0m\u001b[0;34m\" name: \"\u001b[0m \u001b[0;34m+\u001b[0m \u001b[0mstr\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mname\u001b[0m \u001b[0;32mif\u001b[0m \u001b[0mname\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32mNone\u001b[0m \u001b[0;32melse\u001b[0m \u001b[0;34m\"\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 5883\u001b[0;31m   \u001b[0;32mraise\u001b[0m \u001b[0mcore\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_status_to_exception\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0me\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mfrom\u001b[0m \u001b[0;32mNone\u001b[0m  \u001b[0;31m# pylint: disable=protected-access\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   5884\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   5885\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mDataLossError\u001b[0m: {{function_node __wrapped__IteratorGetNext_output_types_2_device_/job:localhost/replica:0/task:0/device:CPU:0}} corrupted record at 3948893 [Op:IteratorGetNext] name: "]}],"source":["import sys\n","for step, (x, y) in enumerate(d_train):\n","    print(x.shape)\n","    print(y.shape)\n","    break"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":685,"status":"ok","timestamp":1712982495336,"user":{"displayName":"Nguyễn Thành Công","userId":"07855209270426231427"},"user_tz":-420},"id":"J6hOBkuekXpw","outputId":"b30f7110-69ed-4232-baf0-7a2f07460ed0"},"outputs":[{"name":"stdout","output_type":"stream","text":["[281 233  67 350 149 195 367 309 205 280 413 213 110 164   6 417 194 147\n"," 355 161 446  90 455 366 460 418 234 453 454   2 123  89 139 202  52 335\n"," 193 381 357 185 347 352 412 262 252 238 254  88 290  71 115  59 181  73\n"," 155 275  98 258 211 172 435 127  44  46 228  50 107 261 451  76 428 229\n"," 201 145 349 177  37 384 300 199  69 354 436 260 308 263 162 117 419 148\n"," 287 400 246  14  15 154 337 175 313 382 431 434  17 113  58 397  75 302\n"," 351 151  77 332 375  87 231  10 380 402 235 257  57  28 321 282 241  43\n"," 269 444 442 200  65 432 253 171 342 408 360 294 104 232 421 310 130 135\n","   3 178 267 430 390 217 383]\n"]}],"source":["\n","import tensorflow as tf\n","\n","# Assuming your tensor is named 'tensor'\n","unique_values, _ = tf.unique(tf.reshape(train, [-1]))\n","\n","# Convert unique values tensor to numpy array\n","unique_values_array = unique_values.numpy()\n","\n","# Print unique values\n","print(unique_values_array)\n"]}],"metadata":{"colab":{"provenance":[{"file_id":"https://storage.googleapis.com/kaggle-colab-exported-notebooks/nt230-ac208e02-406f-4f70-9c9f-cb54fa4b46df.ipynb?X-Goog-Algorithm=GOOG4-RSA-SHA256&X-Goog-Credential=gcp-kaggle-com%40kaggle-161607.iam.gserviceaccount.com/20240411/auto/storage/goog4_request&X-Goog-Date=20240411T232428Z&X-Goog-Expires=259200&X-Goog-SignedHeaders=host&X-Goog-Signature=1450ef1238e8efe62e564b294918909959a42c7f4eadc7994f0376dbf3ef50bb4eb0f8ecbdf034c88478685f76d30e567e7e287f6582fc5d433b5cab09a56ecd59b6ebe0641c9e88f643fcd2cc0b9df98434871f1adaad82af37c8fc2718819997782d18ed9338dc98ac6d3b54cb42f911e5093766bc67fd3ac90a6f4cd0cd3459577e5e185307e43278e31064e9eea382f739f5135493f2652e2cdbecea365a7f56842b98666dead4bfa2e3009d39fec5ab454aa466ad3e20b5ca5826bbd201cdaefb20830b7f4ed3044d739389ad387d1c19d9b4c1cedd460ee1bbc85157b883b45f110da2d6e74dad25b65b4a4c59d37fd0fa3fc1190fa63a6a930e3a4142","timestamp":1712905310154}]},"kaggle":{"accelerator":"none","dataSources":[{"databundleVersionId":46665,"sourceId":4117,"sourceType":"competition"}],"dockerImageVersionId":30684,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.13"}},"nbformat":4,"nbformat_minor":0}